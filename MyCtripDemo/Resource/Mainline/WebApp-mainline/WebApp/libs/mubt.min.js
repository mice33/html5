;window.replace=function(){return ''};(function(f,x){function y(){var a=c.$v("page_id");"wait"!=a&&(a=g.toint(a),(0!=a?g.ready():("complete"==h.readyState?g.ready():0>=c.readyMax&&g.ready())));c.isReady||g.isPVSend||(c.readyMax--,setTimeout(y,1E3))}function z(a){var b;return (c.isArray(a)&&(b=a[0],"_"==b[0]&&c.isFunction(g[b]))?(g[b].apply(g,a.slice(1)),!0):!1)}if(!f.JSON||!f.JSON.parse||!f.JSON.stringify||f.$_bf&&!0===f.$_bf.loaded)return 0;var h=f.document,k=f.screen,l=f.location,r={undefined:"undefined",number:"number","boolean":"boolean",
string:"string","[object Function]":"function","[object RegExp]":"regexp","[object Array]":"array","[object Date]":"date","[object Error]":"error","[object Object]":"object"},A=function(){},C=r.toString,D=(/\$\{(\w+)\}/g),E=(/((test[a-z]?|dev|uat|ui|local)\.sh\.(ctrip|huixuan)travel)|(qa\.nt\.ctripcorp)/i),m="",s="",n="",t=l.href,p="",B="online",q=l.protocol;f.$_bf=f.$_bf||{};f.$_bf.version="1.0.0";f.$_bf.loaded=!0;var v=function(){var a=f.navigator,b=k.colorDepth+"-bit",d=((a.language?a.language:(a.browserLanguage?
a.browserLanguage:""))).toLowerCase(),e="";try{e=h&&h.referrer}catch(u){}if(""==e)try{f.opener&&(e=f.opener.location&&f.opener.location.href)}catch(g){}return{color:b,lang:d,java:0,ref:e,getHash:function(){for(var u=f.history.length||0,g=[a.appName,a.appVersion,d,a.platform,a.userAgent,k.width+k.height,b,(h.cookie?h.cookie:""),e].join(""),F=g.length;0<u;)g+=u--^F++;return c.hash(g)}}}(),c=function(){this.enterTime=c.now();this.isPSSend=this.isPVSend=!1;this.initCFG();this.isNewVid=this.isLogin=this.pid=
0;this.init()};c.fn=c.prototype={constructor:c,version:"1.0.0",_QUEUE:[],initCFG:function(){m=l.hostname.split(".").slice(-2).join(".")||".ctrip.com";this._setEnv(f.$_bf.env||B);s=v.ref},init:function(){this._bfi=this._bfs=this._bfa="";this.readBfa();this.readBfi()},toint:function(a){return parseInt(a,10)||0},plus:function(a){return parseInt(a,10)+1},uniqueID:function(){return(c.getRand()^v.getHash()&2147483647).toString(36)},readBfa:function(){var a=this.getItem("_bfa");a&&(a=a.split("."),6<a.length&&
(this._bfa=a,this.isNewVid=0));this._bfa||(a=this.enterTime,this._bfa=[1,a,this.uniqueID(),1,a,a,0,0],this.isNewVid=1);this.sessRead()},sessRead:function(){var a=this.getItem("_bfs");(a&&!this.isNewVid?(this._bfs=a.split("."),this._bfs[1]=this.plus(this._bfs[1])):(this._bfs=[1,1],this._bfa[4]=this._bfa[5],this._bfa[5]=this.enterTime,this._bfa[6]=this.plus(this._bfa[6])));this._bfa[7]=this.plus(this._bfa[7]);this.setItem("_bfa",this._bfa.join("."),63072E6);this.setItem("_bfs",this._bfs.join("."),18E5)},
readBfi:function(){var a=this.getItem("_bfi");if(a&&(a=a.split("."),4==a.length)){this._bfi=a;this.ppi=a[1];this.ppv=a[3];return}this.ppv=this.ppi=0},writeBfi:function(){var a=[this.ppi,this.getPid(),this.ppv,this.get("pvid")].join(".");this.setItem("_bfi",a)},get:function(a){if(this._bfa){var b=this._bfa;switch(a){case "vid":return b[1]+"."+b[2];case "sid":return this.toint(b[6]);case "pvid":return this.toint(b[7]);case "fullpv":return b[1]+"."+b[2]+"."+b[6]+"."+b[7];default:return""}}},set:function(a,
b){switch(a){case "domain":this._setDomain(b);break;case "clickv1":this._setClickV1(b);break;case "collect":this._delCollect(b);break;case "referrer":this._setReferrer(b);break;case "orderid":this._setOrderID(b)}},getPid:function(){this.pid||(this.pid=this.toint(c.$v("page_id")));return this.pid},getItem:function(a){return("file:"==q?c.getItem(a)||"":c.getCookie(a,!0))},setItem:function(a,b,d){("file:"==q?c.setItem(a,b):c.setCookie(a,b,d))},getABtest:function(){if("undefined"!==typeof this.d_abtest)return this.d_abtest;
for(var a=c.$("ab_testing_tracker"),b=[],d="";a;)d+=a.value||"",b.push(a),a.removeAttribute("id"),a.removeAttribute("name"),a=c.$("ab_testing_tracker");for(a=0;a<b.length;a++)b[a].setAttribute("id","ab_testing_tracker");(b=l.hash||"")&&-1!==b.indexOf("abtest=")&&(d+=decodeURIComponent(b.replace((/.*(abtest=)/i),"").replace((/#.*/i),"")));return this.d_abtest=d},getCommon:function(a){if(!this.d_common||a)this.d_common=[this.getPid(),this.get("vid"),this.get("sid"),this.get("pvid"),c.$v("CorrelationId"),
this.getABtest(),c.$v("bf_ubt_offline_mid")];return this.d_common},getPVParams:function(){if(this.d_params)return this.d_params;var a=c.getCookieObj("Session"),b=c.getCookieObj("CtripUserInfo"),d=c.getCookieObj("StartCity_Pkg"),e=c.getCookieObj("Union"),f=c.$v("bf_ubt_orderid");f&&(p=f);a={engine:(a&&a.SmartLinkCode?a.SmartLinkCode:""),keyword:(a&&a.SmartLinkQuary?a.SmartLinkQuary:""),start_city:(d&&d.PkgStartCity?d.PkgStartCity:""),alliance_id:(e&&e.AllianceID?e.AllianceID:""),alliance_sid:(e&&e.SID?e.SID:
""),alliance_ouid:(e&&e.OUID?e.OUID:""),user_grade:(b&&b.VipGrade?b.VipGrade:""),duid:(b&&b.U?b.U:""),zdata:c.getCookie("zdatactrip"),callid:c.$v("bf_ubt_tl_callid")};a.duid&&(this.isLogin=1);return this.d_params=a},getUinfo:function(){var a=this.getPVParams(),b=[9];b[1]=this.ppi;b[2]=this.ppv;b[3]=String(t).substring(0,600);b[4]=k.width;b[5]=k.height;b[6]="";b[7]=v.lang;b[8]=a.engine;b[9]=a.keyword;b[10]=s;b[11]=this.getABtest();b[12]=this.isNewVid;b[13]=this.isLogin;b[14]=c.getCookie("login_uid");b[15]=
a.user_grade;b[16]=c.getCookie("corpid");b[17]=a.start_city;b[18]=a.alliance_id;b[19]=a.alliance_sid;b[20]=a.alliance_ouid;b[21]=p||"";b[22]=a.duid;b[23]=a.zdata;b[24]=a.callid;b[25]=c.getCookie("bid");b[26]=c.getItem("GUID");b[27]=c.getItem("SOURCEID");return b},sendPV:function(a){var b=this;if(this.isPVSend)return!0;try{var d={c:this.getCommon(!0),d:{uinfo:this.getUinfo()}},e="ac=g&d="+encodeURIComponent(JSON.stringify(d));c.send(e,function(d){d&&(b.isPVSend=!0,b.queueSend_());c.isFunction(a)&&
a(d)})}catch(f){}},replaceParam:function(a){var b={duid:this.getPVParams().duid,page_id:this.getPid(),is_login:this.isLogin};return a.replace(D,function(a,e){return (e in b?b[e]:a)})},dataHandle:function(a){if("string"==typeof a)return a;if("object"==typeof a){if(a.c&&a.d)return a={c:this.getCommon(),d:a.d},"ac=g&d="+encodeURIComponent(JSON.stringify(a));if(a.k&&a.v){var b=encodeURIComponent(this.replaceParam(a.v));return"ac=tl&pi="+this.getPid()+"&key="+a.k+"&val="+b+"&pv="+this.get("fullpv")+"&v=6"}}return!1},
sendData:function(a){if(this.isPVSend){var b=this.dataHandle(a);b&&c.send(b,a.callback||A)}else this._QUEUE.push(a)},queueSend_:function(){var a=this._QUEUE,b=a.length;if(0<b){for(var d=0;d<b;d++){var e=a[d],f=this.dataHandle(e);f&&c.send(f,e.callback||A)}this._QUEUE=[]}},getPS:function(){for(var a="navigationStart redirectStart unloadEventStart unloadEventEnd redirectEnd fetchStart domainLookupStart domainLookupEnd connectStart connectEnd requestStart responseStart responseEnd domLoading domInteractive domContentLoadedEventStart domContentLoadedEventEnd domComplete loadEventStart loadEventEnd".split(" "),
b=f.performance.timing,d=[6],e=0;e<a.length;e++)d.push(b[a[e]]);d.push(f.performance.navigation.type||0);d.push(f.performance.navigation.redirectCount||0);return d},sendPS:function(){function a(){if(f.performance.timing.loadEventEnd&&!d.isPSSend){var e={c:d.getCommon(),d:{ps:d.getPS()}},e="ac=g&d="+encodeURIComponent(JSON.stringify(e));c.send(e);d.isPSSend=!0}else 300>b&&(b++,setTimeout(a,1E3))}if(f.performance&&!(0>=this.pid)){var b=0,d=this;a()}},ready:function(){c.isReady=!0;this.sendPV();this.writeBfi();
this.sendPS()}};c.extend=c.fn.extend=function(){var a,b,d,e=arguments[0]||{},c=1,f=arguments.length;f===c&&(e=this,--c);for(;c<f;c++)if(null!=(d=arguments[c]))for(b in d)a=d[b],e!==a&&a!==x&&(e[b]=a);return e};c.extend({isReady:!1,readyMax:10,now:Date.now||function(){return(new Date).getTime()},isFunction:function(a){return"function"===c.type(a)},isArray:function(a){return"array"===c.type(a)},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return r[typeof a]||r[C.call(a)]||
((a?"object":"null"))},isEmpty:function(a){return a===x||"-"==a||""==a},contains:function(a,b){return-1<a.indexOf(b)},getRand:function(){return Math.round(2147483647*Math.random())},hash:function(a){var b=1,d=0,e;if(!c.isEmpty(a))for(b=0,e=a.length-1;0<=e;e--)d=a.charCodeAt(e),b=(b<<6&268435455)+d+(d<<14),d=b&266338304,b=(0!=d?b^d>>21:b);return b},each:function(a,b,d){var c=0;if(d)for(c in a){if(b.apply(a[c],d),!1===value)break}else for(c in a)if(value=b.call(a[c],c,a[c]),!1===value)break;return a},setCookie:function(a,
b,d){var e=(m?";domain="+m:""),f="";0<=d&&(f=";expires="+(new Date(c.now()+d)).toUTCString());h.cookie=a+"="+encodeURIComponent(b)+e+";path=/"+f},getCookie:function(a,b){var c=h.cookie.match(RegExp("(^| )"+a+"=([^;]*)(;|$)"));return (c?(b?decodeURIComponent(c[2]):c[2]):"")},getCookieObj:function(a,b){var d={__k:a},e=[],f;if(e=c.getCookie(a,b))for(var e=e.split("&"),g=0;g<e.length;g++)f=e[g].split("="),1<f.length&&(d[f[0]]=f[1]);return d},getItem:function(a){return("undefined"!=typeof localStorage?localStorage.getItem(a)||
"":"")},setItem:function(a,b,c){"undefined"!=typeof localStorage&&localStorage.setItem(a,b)},$:function(a){return("string"!==typeof a?!1:h.getElementById(a))},$v:function(a){return(a=c.$(a))&&a.value||""},send:function(a,b){var d=n+"bf.gif",d=d+("?"+a+"&rd="+(c.getRand()&c.now())+"&jv=1.0.0"),e=(new Image);e.onload=function(){e=e.onload=null;c.isFunction(b)&&b(1)};e.src=d}});c.on=function(){if(h.addEventListener)return function(a,b,c,e){a.addEventListener(b,c,flug)};if(h.attachEvent)return function(a,
b,c){a.attachEvent("on"+b,c)}}();c.fn.extend({_setDebug:function(a){},_setEnv:function(a){var b=("file:"==q?"http:":q);("test"==a||E.test(t)?(a="test",n=b+"//ubt.test.sh.ctriptravel.com/"):("offline"==a?n=b+"//ubt.sh.ctriptravel.com/":"online"==a&&(n=b+"//s.c-ctrip.com/")));B=a},_setDomain:function(a){m=a},_setClickV1:function(a){},_setReferrer:function(a){s=a},_setOrderID:function(a){a&&(p=a)},_delCollect:function(a){},_asynRefresh:function(a,b){"object"==typeof a&&(a.page_id&&(this.pid=this.toint(a.page_id)),
a.url&&c.contains(a.url,"http:")&&(t=a.url),a.orderid&&(p=a.orderid));this.isPVSend&&this.init();this.isPVSend=!1;this.sendPV();this.writeBfi()},_tracklog:function(a,b,c){if("string"!=typeof b)return!1;this.sendData({k:a,v:b,callback:c||!1})},_trackError:function(a,b){},_trackUserBlock:function(a,b){},_getFullPV:function(a){var b=this._bfa;a&&c.isFunction(a)&&a(b);return b}});var g=new c;f.$_bf._getFullPV=function(){return g.get("fullpv")};f.$_bf.tracklog=function(a,b,c){g._tracklog(a,b,c)};f.$_bf.trackError=
function(a,b){g._trackError(a,b)};f.$_bf.asynRefresh=function(a,b){g._asynRefresh(a,b)};y();if("array"==c.type(f.__bfi))for(var G=f.__bfi.length,w=0;w<G;w++)z(f.__bfi[w]);else f.__bfi=[];f.__bfi.push=z})(window);
