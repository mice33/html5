define(["cBase","cStorage","libs","CommonStore","cModel"],function(a,b,c,d,e){function f(a){var b=".__hreftel__",c=".__conttel__",d=".__appaddress__";$(a[0]).find(b).each(function(){this.href=v(this.href)}),$(a[0]).find(c).each(function(){var a=$(this);a.html(v(a.html()))}),$(d).each(function(){var a=w();if(!a)switch(!0){case s:a=$(this).attr("data-ios-app");break;case t:a=$(this).attr("data-android-app");break;case u:a=$(this).attr("data-win-app")}a&&$(this).attr("href",a)})}var g=null,h=d.SalesObjectStore.getInstance(),i=function(a){return e.baseurl(a)},j=function(c,d,e){var f=h.get(c);if(f)g=f,!f.appurl||f.appurl.length<=0?$("#dl_app").hide():$("#dl_app").show(),d&&d(f);else{var j=i(),k="http://"+(j&&j.domain)+"/html5/ClientData/GetSalesInfo/"+c;$.ajax({url:k,type:"POST",dataType:"json",success:$.proxy(function(f){var i={};if(1==f.ServerCode){if(f.Data){for(var j in f.Data)i[j.toLowerCase()]=f.Data[j];f.Data=i,h.set(f.Data,c);var k=30;!f.Data||"ydwxcs"!==f.Data.sales&&"1622"!==f.Data.sales||(k=5),!f.Data.appurl||f.Data.appurl.length<=0?$("#dl_app").hide():$("#dl_app").show(),b.localStorage.oldSet("SALESOBJ",JSON.stringify({data:f.Data,timeout:new a.Date(a.getServerDate()).addDay(k).format("Y/m/d H:i:s")}))}g=f.Data,d&&d(f.Data)}else e&&e(f)},this),error:$.proxy(function(a){e&&e(a)},this)})}},k=function(){return g},l=function(a){d.SalesStore.getInstance().set({sales:a})},m=function(a){d.SalesStore.getInstance().set({sourceid:a})},n=function(a){d.UnionStore.getInstance().set(a)},o=/400\d{3}\d{4}/i,p=/400\s+\d{3}\s+\d{4}/i,q=/400-\d{3}-\d{4}/i,r=navigator.userAgent,s=!!r.match(/(ipad|iphone)/i),t=!!r.match(/android/i),u=!!r.match(/MSIE/i),v=window.replaceStrTel=function(a){var b=k();return"string"==typeof a&&b&&b.tel&&(a=a.replace(o,b.tel),a=a.replace(p,b.teltitle),b.teltitle&&(a=a.replace(q,b.teltitle.split(" ").join("-")))),a},w=function(a){var b=k();if(b){if(b.isseo&&$(".module").show(),b.appurl)return b.appurl;var a=b.sid?b.sid:b.sales;return"/market/download.aspx?from="+a}return null};return{replaceContent:f,replaceStrTel:v,setSales:l,getSales:k,getSalesObject:j,setUnion:n,setSourceId:m}});